# ハンドオフ手順

複数のチャットセッションにまたがる開発で、作業内容を引き継ぐための手順です。

---

## なぜハンドオフが必要か

- AI チャットはセッションが変わるとコンテキストがリセットされる
- 過去の決定事項・未完了タスク・既知の問題を明示的に引き継ぐ必要がある
- テンプレートを使うことで、引き継ぎ漏れを防ぐ

---

## ハンドオフのタイミング

- チャットを終える前
- 大きなタスクを区切ったとき
- 別の人に作業を引き継ぐとき
- 数日間開発を中断するとき

---

## 1) このチャットでやったこと(主な成果)
- キャラクター作成/編集(立ち絵の感情/パターン/ラベル/並び順、拡大プレビュー、ドラッグ並べ替え)
- 公開ギャラリー・アップロード・管理・お気に入りに**タブ統合**(アセット/キャラクター)
- お気に入り機能を**アセット/キャラクターの両方**に実装(登録/解除/一覧)
- アセット削除の500修正、UIトースト整備

## 2) 現在の状態
- ギャラリー/管理/お気に入り:すべて動作
- サムネ:TTL切れにも概ね自動復旧
- CI:グリーン

## 3) 次チャットでやること(優先順)
- サムネ最適化(AVIF/WebP/品質自動/事前フェッチ)
- サーバ側フィルタ統一(Meiliに寄せる)＋お気に入りも同スキーマに
- E2E/ユニット(♡トグル、署名GET再取得、編集/削除ガード、アップロード一連)
- 削除UX(Undo/Trash → バッチで実削除)
- 将来: 会話辞書とキャラクターの連動(感情→表情画像の自動選択)

## 4) 開発の進め方(お約束)
- 変更は**最小差分パッチ**(`apply patch:` 形式)で提示 → Copilot実行 → 手動コミット
- `$api` を必ず経由(Authorization 自動付与)。直 fetch 禁止
- 画像URLは**署名GETの JSON を解釈してから `<img>`** へ
- `@nuxt/icon` は modulesで使用(直接importしない)
- CI は `--frozen-lockfile`

---

## ハンドオフの手順

### 1. 作業内容を整理

現在のセッションで何をしたか、何が残っているかをまとめます。

### 2. テンプレートをコピー

[ハンドオフテンプレート](./templates/HANDOFF_CONTEXT_TEMPLATE.md) をコピーして、次のチャットに貼り付けます。

### 3. 各セクションを埋める

| セクション         | 内容                                                      |
|--------------------|-----------------------------------------------------------|
| 今日のゴール       | このセッションで達成したいこと                            |
| 現在の状態         | 画面のスクリーンショット or 動作状況                      |
| 直近の変更         | 編集したファイル・追加した機能                            |
| 既知の問題         | 未解決のバグ・警告                                        |
| 次の一手           | 次にやるべきこと (優先順位付き)                           |
| 参考リンク         | PR, Issue, CI, スクリーンショットの URL                   |

### 4. ADR を更新 (重要な決定があった場合)

[ADR](./adr/README.md) に設計判断を記録してください。

### 5. 次のチャットでテンプレートを貼る

新しいチャットで、埋めたテンプレートをそのまま貼り付けてください。

---

## テンプレートの場所

- [HANDOFF_CONTEXT_TEMPLATE.md](./templates/HANDOFF_CONTEXT_TEMPLATE.md)

---

## 例: ハンドオフの実際の使い方

### セッション A (終了時)

```markdown
## 今日のゴール
- 公開ギャラリー画面にタグフィルタを追加

## 現在の状態
- タグ選択 UI は実装完了
- API 側のタグフィルタは未実装

## 直近の変更
- `apps/frontend/pages/assets/index.vue`: タグ選択 UI 追加
- `apps/api/src/assets/dto/query-assets.dto.ts`: tags フィールド追加 (未実装)

## 既知の問題
- tags でフィルタしても全件返ってくる

## 次の一手
1. API 側で tags クエリを Prisma に反映
2. Frontend でタグフィルタ動作確認

## 参考リンク
- PR: https://github.com/org/repo/pull/123
```

### セッション B (開始時)

上記のテンプレートをそのまま貼って、次のように指示します:

```markdown
前回の続きです。API 側のタグフィルタを実装してください。

(上記のハンドオフテンプレートを貼る)
```

---

## ベストプラクティス

- **スクリーンショットを撮る**: 画面の状態を視覚化
- **ファイルパスを明記**: 変更箇所が一目でわかる
- **優先順位をつける**: 次の一手は具体的に
- **ADR を活用**: 「なぜこの設計にしたか」を残す

---

## 関連ドキュメント

- [プロンプトテンプレート](./prompts/README.md): タスク指示の書き方
- [ADR](./adr/README.md): 設計判断の記録
- [ワークフロー](./workflow.md): ブランチ・コミット規約
